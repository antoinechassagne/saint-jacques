(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{29:function(e,t,a){e.exports=a(57)},56:function(e,t,a){},57:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(24),u=a.n(r),s=a(8),l=a(7),i=function(e){var t=document.cookie.match(new RegExp("(^| )".concat(e,"=([^;]+)")));return t?t[2]:null},o=function(e,t){document.cookie="".concat(e,"=").concat(t)},m=function(e){document.cookie="".concat(e,"=;expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/saint-jacques")},p=function(e){var t=Object.keys(e.pages).filter((function(t){return e.pages[t].menu})).map((function(t){return e.pages[t]}));e.isLogged||t.push(e.pages.signIn);return c.a.createElement("header",{className:"header"},c.a.createElement("span",{className:"header__brand"},"Saint Jacques"),c.a.createElement("nav",null,c.a.createElement("ul",{className:"header__menu"},Object.keys(t).map((function(e,a){return c.a.createElement("li",{key:a},c.a.createElement(l.c,{exact:!0,to:"".concat("/saint-jacques").concat(t[e].path),activeClassName:"active"},t[e].label))}))),e.isLogged&&c.a.createElement("button",{onClick:function(){m("jwt"),window.location.replace("".concat("/saint-jacques").concat(e.pages.home.path))}},"Se d\xe9connecter")))},d=a(1),f=function(){return Math.random().toString(36).substring(2,5)+Math.random().toString(36).substring(2,5)},b=function(e){var t=Object(n.useState)(!1),a=Object(d.a)(t,2),r=a[0],u=a[1],s=Object(n.useState)(!1),i=Object(d.a)(s,2),o=i[0],m=i[1],p=Object(n.useState)([]),b=Object(d.a)(p,2),E=b[0],v=b[1],h=Object(n.useState)(!1),j=Object(d.a)(h,2),g=j[0],O=j[1],S=Object(n.useState)(null),w=Object(d.a)(S,2),q=w[0],N=w[1],k=Object(n.useState)(null),C=Object(d.a)(k,2),_=C[0],L=C[1],y=Object(n.useRef)(null),x=Object(n.useRef)(null),F=Object(n.useCallback)((function(e){e.target.isSameNode(x.current)||e.target.isSameNode(y.current)||(O(!1),x.current.value="",window.removeEventListener("click",F))}),[]),J=function(t){u(!0),O(!0);var a=t.target.value;if(!a)return v([]),void O(!1);clearTimeout(N(q)),N(setTimeout((function(){var t;L(f()),t=a,_===_&&(m(!1),e.search(t).then((function(e){var t=e.data;v(t),u(!1)})).catch((function(){m(!0),u(!1)})))}),800))};Object(n.useEffect)((function(){return g?window.addEventListener("click",F):window.removeEventListener("click",F),function(){return window.removeEventListener("click",F)}}),[g,F]);return c.a.createElement("div",{className:"search"},c.a.createElement("div",{className:"input"},c.a.createElement("label",{className:"input__label",htmlFor:e.name},e.label),c.a.createElement("input",{className:"input__input",type:"text",name:e.name,ref:x,onChange:function(e){J(e)}})),c.a.createElement("div",{ref:y,className:g?"search__results search__results--active":"search__results"},r?c.a.createElement("span",null,"Chargement..."):o?c.a.createElement("span",null,"Une erreur est survenue."):E.length?c.a.createElement("ul",null,E.map((function(e,t){return c.a.createElement("li",{key:t},c.a.createElement(l.b,{to:"".concat("/saint-jacques","/spots/").concat(e.id)},e.name))}))):c.a.createElement("span",null,"Aucun r\xe9sultat trouv\xe9.")))},E=a(27),v=a.n(E).a.create({baseURL:"https://saint-jacques.herokuapp.com/api"});v.interceptors.request.use((function(e){var t=i("jwt");return null!=t&&(e.headers.Authorization="Bearer ".concat(t)),e}),(function(e){return Promise.reject(e)})),v.interceptors.response.use((function(e){return e}),(function(e){return 401===e.response.status&&(m("jwt"),window.location.replace("".concat("/saint-jacques").concat(_.login.path))),404===e.response.status&&window.location.replace("".concat("/saint-jacques").concat(_.notFound.path)),Promise.reject(e)}));var h=v,j={fetchSpots:function(){return h.get("/spots")},fetchSpot:function(e){return h.get("/spots/".concat(e))},searchSpot:function(e){return h.get("/spots/search",{params:{search:e}})}},g=function(){return document.title="Saint Jacques",c.a.createElement("section",{className:"page"},c.a.createElement("h1",null,"Bienvenue sur Saint Jacques"),c.a.createElement(b,{label:"Rechercher un spot",search:j.searchSpot}))},O={signIn:function(e){var t=e.email,a=e.password;return h.post("/signin",{email:t,password:a})},signUp:function(e){var t=e.email,a=e.password;return h.post("/signup",{email:t,password:a})}},S=a(28),w=function(e){return c.a.createElement("button",{className:"button button--primary"},e.children)},q=function(e){var t=Object(n.useState)({}),a=Object(d.a)(t,2),r=a[0],u=a[1],s=function(e){var t=Object(S.a)({},r);e.valid?t[e.name]=e:(delete t[e.name].value,t[e.name].valid=!1),u(t)},l=c.a.Children.map(e.children,(function(e){if(e)return c.a.cloneElement(e,{inputChange:s})})).filter((function(e){return e}));return Object(n.useEffect)((function(){var t={};e.children.forEach((function(e){e&&(t[e.props.name]={name:e.props.name,valid:!e.props.required,required:!!e.props.required})})),u(t)}),[u]),c.a.createElement("form",{className:"form",onSubmit:function(t){t.preventDefault(),function(){var t={},a=!1;Object.keys(r).forEach((function(e){a||(r[e].valid?Object.prototype.hasOwnProperty.call(r[e],"value")&&(t[r[e].name]=r[e].value):a=!0)})),a||e.submit(t)}()}},l,c.a.createElement(w,null,e.buttonLabel))},N=function(e){var t=Object(n.useState)(""),a=Object(d.a)(t,2),r=a[0],u=a[1],s=Object(n.useState)(!0),l=Object(d.a)(s,2),i=l[0],o=l[1],m=Object(n.useState)(!0),p=Object(d.a)(m,2),f=p[0],b=p[1];return Object(n.useEffect)((function(){f||function(){if(e.validation&&!f)if(!e.required||r){var t=new RegExp("[^@]+@[^.]+..+"),a=r.match(t);o(!!a)}else o(!1)}(),e.inputChange({name:e.name,value:r,valid:i,required:e.required})}),[f,r,i]),c.a.createElement("div",{className:"input"},c.a.createElement("label",{className:"input__label",htmlFor:e.name},e.label),c.a.createElement("input",{className:"input__input",type:"email",value:r,name:e.name,required:e.required,onChange:function(e){return u(e.target.value)},onBlur:function(e){f?b(!1):u(e.target.value)}}),!i&&c.a.createElement("span",{className:"error"},"Veuillez saisir une adresse email valide."))},k=function(e){var t=Object(n.useState)(""),a=Object(d.a)(t,2),r=a[0],u=a[1],s=Object(n.useState)(!0),l=Object(d.a)(s,2),i=l[0],o=l[1],m=Object(n.useState)(!0),p=Object(d.a)(m,2),f=p[0],b=p[1];return Object(n.useEffect)((function(){f||function(){if(e.validation&&!f)if(!e.required||r){var t=r.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,15}$/);o(!!t)}else o(!1)}(),e.inputChange({name:e.name,value:r,valid:i,required:e.required})}),[f,r,i]),c.a.createElement("div",{className:"input"},c.a.createElement("label",{className:"input__label",htmlFor:e.name},e.label),c.a.createElement("input",{className:"input__input",type:"password",value:r,name:e.name,required:e.required,onChange:function(e){return u(e.target.value)},onBlur:function(e){f?b(!1):u(e.target.value)}}),!i&&c.a.createElement("p",{className:"error"},"Le mot de passe doit contenir au moins 8 caract\xe8res (dont au moins une majuscule, une minuscule, un chiffre et un caract\xe8re sp\xe9cial)."))},C={addFavoriteSpot:function(e){return h.get("/users/add-favorite-spot",{params:{spot:e}})},removeFavoriteSpot:function(e){return h.get("/users/remove-favorite-spot",{params:{spot:e}})}},_={home:{path:"/",label:"Accueil",component:g,menu:!0,guard:!1},spots:{path:"/spots",label:"Spots",component:function(){document.title="Saint Jacques | Spots";var e=Object(n.useState)([]),t=Object(d.a)(e,2),a=t[0],r=t[1],u=Object(n.useState)(!0),s=Object(d.a)(u,2),l=s[0],i=s[1],o=Object(n.useState)(!1),m=Object(d.a)(o,2),p=m[0],f=m[1];Object(n.useEffect)((function(){j.fetchSpots().then((function(e){var t=e.data;r(t["hydra:member"]),i(!1)})).catch((function(){f(!0),i(!1)}))}),[]);return c.a.createElement("section",{className:"page"},c.a.createElement("h1",null,"Tous les spots"),l?c.a.createElement("span",null,"Chargement..."):p?c.a.createElement("span",null,"Une erreur est survenue."):a.length?c.a.createElement("ul",null,a.map((function(e,t){return c.a.createElement("li",{key:t},c.a.createElement("h3",null,e.name),c.a.createElement("span",null,"Longitude : ",e.longitude),c.a.createElement("span",null,"Latitude : ",e.longitude),c.a.createElement("p",null,e.description))}))):c.a.createElement("span",null,"Aucun spot trouv\xe9."))},menu:!0,guard:!1},spot:{path:"/spots/:id",label:"Spot",component:function(){var e=Object(n.useState)(!0),t=Object(d.a)(e,2),a=t[0],r=t[1],u=Object(n.useState)(!1),l=Object(d.a)(u,2),o=l[0],m=l[1],p=Object(n.useState)(!1),f=Object(d.a)(p,2),b=f[0],E=f[1],v=Object(n.useState)(!1),h=Object(d.a)(v,2),g=(h[0],h[1]),O=Object(n.useState)(!1),S=Object(d.a)(O,2),w=(S[0],S[1]),q=Object(n.useState)(null),N=Object(d.a)(q,2),k=N[0],L=N[1],y=Object(s.g)(),x=function(){return!!i("jwt")?c.a.createElement("button",{onClick:function(){return w(!0),g(!0),void C[b?"removeFavoriteSpot":"addFavoriteSpot"](y.id).then((function(){g(!1)})).catch((function(){w(!0),g(!1)}))}},b?"Retirer de mes favoris":"Ajouter \xe0 mes favoris"):c.a.createElement("div",null,c.a.createElement("span",null,"Connectez-vous pour ajouter ce spot \xe0 vos favoris"),c.a.createElement("button",{onClick:function(){window.location.replace("".concat("/saint-jacques").concat(_.login.path))}},"Se connecter"))};Object(n.useEffect)((function(){j.fetchSpot(y.id).then((function(e){var t=e.data;L(t),E(!1),r(!1)})).catch((function(){m(!0),r(!1)}))}),[]);return c.a.createElement("section",{className:"page"},a?c.a.createElement("span",null,"Chargement..."):o?c.a.createElement("span",null,"Une erreur est survenue."):c.a.createElement(c.a.Fragment,null,c.a.createElement("h1",null,k.name),c.a.createElement("span",null,"Longitude : ",k.longitude),c.a.createElement("span",null,"Latitude : ",k.longitude),c.a.createElement("p",null,k.description),x()))},menu:!1,guard:!1},signIn:{path:"/sign-in",label:"Se connecter",component:function(){document.title="Saint Jacques | Connexion";var e=Object(n.useState)(!1),t=Object(d.a)(e,2),a=t[0],r=t[1],u=Object(n.useState)(!1),s=Object(d.a)(u,2),i=s[0],m=s[1];return c.a.createElement("section",{className:"page page--sign-in"},c.a.createElement("h1",null,"Se connecter"),i&&c.a.createElement("span",{class:"error"},"Les identifiants saisis ne sont pas valides."),c.a.createElement(q,{submit:function(e){return function(e){r(!0);var t=e.email,a=e.password;O.signIn({email:t,password:a}).then((function(e){200===e.status?(o("jwt",e.data.token),window.location.replace("".concat("/saint-jacques"))):(m(!0),r(!1))})).catch((function(){m(!0),r(!1)}))}(e)},buttonLabel:"Se connecter"},c.a.createElement(N,{required:!0,validation:!0,name:"email",label:"Email"}),c.a.createElement(k,{required:!0,validation:!1,name:"password",label:"Mot de passe"})),a&&c.a.createElement("span",null,"Chargement..."),c.a.createElement("span",null,"Vous n'avez pas encore de compte ? "),c.a.createElement(l.c,{exact:!0,to:"".concat("/saint-jacques").concat(_.signUp.path)},"Cr\xe9ez en un d\xe8s maintenant !"))},menu:!1,guard:!1},signUp:{path:"/sign-up",label:"S'inscrire'",component:function(){document.title="Saint Jacques | S'inscrire";var e=Object(n.useState)(!1),t=Object(d.a)(e,2),a=t[0],r=t[1],u=Object(n.useState)(!1),s=Object(d.a)(u,2),l=s[0],i=s[1],m=Object(n.useState)(!0),p=Object(d.a)(m,2),f=p[0],b=p[1];return c.a.createElement("section",{className:"page page--login"},c.a.createElement("h1",null,"S'inscrire"),l&&c.a.createElement("span",{className:"error"},"Les identifiants saisis ne sont pas valides. Il se peut que l'adresse email saisie soit d\xe9j\xe0 associ\xe9e \xe0 un compte."),c.a.createElement(q,{submit:function(e){return function(e){var t=e.email,a=e.password,n=e.passwordConfirmation;a===n?(b(!0),r(!0),O.signUp({email:t,password:a}).then((function(){O.login({email:t,password:a}).then((function(e){o("jwt",e.data.token),window.location.replace("".concat("/saint-jacques"))})).catch((function(){i(!0),r(!1)}))})).catch((function(){i(!0),r(!1)}))):b(!1)}(e)},buttonLabel:"S'inscrire"},c.a.createElement(N,{required:!0,validation:!0,name:"email",label:"Adresse email"}),c.a.createElement(k,{required:!0,validation:!0,name:"password",label:"Mot de passe"}),c.a.createElement(k,{required:!0,name:"passwordConfirmation",label:"Conformation du mot de passe"}),!f&&c.a.createElement("span",{className:"error"},"Les mots de passe saisis ne sont pas identiques."),a&&c.a.createElement("span",null,"Chargement...")))},menu:!1,guard:!1},notfound:{path:"/404",label:"Erreur 404",component:function(){return document.title="Saint Jacques |\xa0404",c.a.createElement("section",{className:"page"},c.a.createElement("h1",null,"Erreur 404"),c.a.createElement("p",null,"Cette pas n'existe pas..."," ",c.a.createElement("span",{role:"img","aria-label":"Sad face emoji"},"\ud83d\ude1e")))},menu:!1,guard:!1}},L=function(){var e=!!i("jwt"),t=Object.keys(_).map((function(t,a){var n=_[t],r=n.path,u=n.component,l=n.guard;return c.a.createElement(s.b,{key:a,exact:!0,path:"".concat("/saint-jacques").concat(r),render:function(){return function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0,n=a;return t?e?c.a.createElement(n,null):c.a.createElement(s.a,{to:"".concat("/saint-jacques").concat(_.signIn.path)}):c.a.createElement(n,null)}(l,u)}})}));return c.a.createElement(l.a,null,c.a.createElement(c.a.Fragment,null,c.a.createElement(p,{pages:_,isLogged:e}),c.a.createElement("main",null,c.a.createElement(s.d,null,t))))};a(56);u.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(L,null)),document.getElementById("root"))}},[[29,1,2]]]);
//# sourceMappingURL=main.d01917ad.chunk.js.map