(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{29:function(e,t,a){e.exports=a(57)},56:function(e,t,a){},57:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(24),s=a.n(r),u=a(8),o=a(5),l=function(e){var t=document.cookie.match(new RegExp("(^| )".concat(e,"=([^;]+)")));return t?t[2]:null},i=function(e,t){document.cookie="".concat(e,"=").concat(t)},m=function(e){document.cookie="".concat(e,"=;expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/saint-jacques")},p=function(e){var t=Object.keys(e.pages).filter((function(t){return e.pages[t].menu})).map((function(t){return e.pages[t]}));e.isLogged||t.push(e.pages.signIn);return c.a.createElement("header",{className:"header mb--xl"},c.a.createElement(o.c,{exact:!0,to:"".concat("/saint-jacques"),className:"header__brand"},"Saint Jacques"),c.a.createElement("nav",null,c.a.createElement("ul",{className:"header__menu"},Object.keys(t).map((function(e,a){return c.a.createElement("li",{key:a},c.a.createElement(o.c,{exact:!0,to:"".concat("/saint-jacques").concat(t[e].path),activeClassName:"active"},t[e].label))}))),e.isLogged&&c.a.createElement("button",{onClick:function(){m("jwt"),window.location.replace("".concat("/saint-jacques").concat(e.pages.home.path))}},"Se d\xe9connecter")))},d=a(1),f=function(){return Math.random().toString(36).substring(2,5)+Math.random().toString(36).substring(2,5)},b=function(e){var t=Object(n.useState)(!1),a=Object(d.a)(t,2),r=a[0],s=a[1],u=Object(n.useState)(!1),l=Object(d.a)(u,2),i=l[0],m=l[1],p=Object(n.useState)([]),b=Object(d.a)(p,2),v=b[0],E=b[1],h=Object(n.useState)(!1),j=Object(d.a)(h,2),g=j[0],O=j[1],S=Object(n.useState)(null),w=Object(d.a)(S,2),q=w[0],k=w[1],N=Object(n.useState)(null),C=Object(d.a)(N,2),_=C[0],L=C[1],y=Object(n.useRef)(null),x=Object(n.useRef)(null),F=Object(n.useCallback)((function(e){e.target.isSameNode(x.current)||e.target.isSameNode(y.current)||(O(!1),x.current.value="",window.removeEventListener("click",F))}),[]),J=function(t){s(!0),O(!0);var a=t.target.value;if(!a)return E([]),void O(!1);clearTimeout(k(q)),k(setTimeout((function(){var t;L(f()),t=a,_===_&&(m(!1),e.search(t).then((function(e){var t=e.data;E(t),s(!1)})).catch((function(){m(!0),s(!1)})))}),800))};Object(n.useEffect)((function(){return g?window.addEventListener("click",F):window.removeEventListener("click",F),function(){return window.removeEventListener("click",F)}}),[g,F]);return c.a.createElement("div",{className:"search"},c.a.createElement("div",{className:"input"},c.a.createElement("label",{className:"input__label",htmlFor:e.name},e.label),c.a.createElement("input",{className:"input__input",type:"text",name:e.name,ref:x,onChange:function(e){J(e)}})),c.a.createElement("div",{ref:y,className:g?"search__results search__results--active":"search__results"},r?c.a.createElement("span",null,"Chargement..."):i?c.a.createElement("span",null,"Une erreur est survenue."):v.length?c.a.createElement("ul",null,v.map((function(e,t){return c.a.createElement("li",{key:t},c.a.createElement(o.b,{to:"".concat("/saint-jacques","/spots/").concat(e.id)},e.name))}))):c.a.createElement("span",null,"Aucun r\xe9sultat trouv\xe9.")))},v=a(27),E=a.n(v).a.create({baseURL:"https://saint-jacques.herokuapp.com/api"});E.interceptors.request.use((function(e){var t=l("jwt");return null!=t&&(e.headers.Authorization="Bearer ".concat(t)),e}),(function(e){return Promise.reject(e)})),E.interceptors.response.use((function(e){return e}),(function(e){return 401===e.response.status&&(m("jwt"),document.location.reload(!0),window.location.replace("".concat("/saint-jacques").concat(L.signIn.path))),404===e.response.status&&window.location.replace("".concat("/saint-jacques").concat(L.notFound.path)),Promise.reject(e)}));var h=E,j={fetchSpots:function(){return h.get("/spots")},fetchSpot:function(e){return h.get("/spots/".concat(e))},searchSpot:function(e){return h.get("/search/spots",{params:{search:e}})}},g={fetchUserFavoriteSpots:function(){return h.get("/users/favorite-spots")},addFavoriteSpot:function(e){return h.get("/users/add-favorite-spot",{params:{spot:e}})},removeFavoriteSpot:function(e){return h.get("/users/remove-favorite-spot",{params:{spot:e}})}},O=function(){document.title="Saint Jacques";var e=Object(n.useState)([]),t=Object(d.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(!0),u=Object(d.a)(s,2),o=u[0],i=u[1],m=Object(n.useState)(!1),p=Object(d.a)(m,2),f=(p[0],p[1]),v=!!l("jwt");Object(n.useEffect)((function(){v&&(i(!0),v&&g.fetchUserFavoriteSpots().then((function(e){var t=e.data;i(!1),r(t)})).catch((function(){f(!0),i(!1)})))}),[]);return c.a.createElement("section",null,c.a.createElement("h1",null,"Bienvenue sur Saint Jacques"),c.a.createElement(b,{label:"Rechercher un spot",search:j.searchSpot}),function(){if(v)return c.a.createElement("div",{className:"favorite-spots"},c.a.createElement("h3",null,"Spots favoris"),o&&c.a.createElement("span",null,"Chargement..."),!o&&!a.length&&c.a.createElement("span",null,"Aucun spots favoris."),a.map((function(e){return c.a.createElement("h4",null,e.name)})))}())},S=function(e){var t=e.email,a=e.password;return h.post("/signin",{email:t,password:a})},w=function(e){var t=e.email,a=e.password;return h.post("/signup",{email:t,password:a})},q=a(28),k=function(e){return c.a.createElement("button",{className:"button button--primary"},e.children)},N=function(e){var t=Object(n.useState)({}),a=Object(d.a)(t,2),r=a[0],s=a[1],u=function(e){var t=Object(q.a)({},r);e.valid?t[e.name]=e:(delete t[e.name].value,t[e.name].valid=!1),s(t)},o=function(){var t={},a=!1;Object.keys(r).forEach((function(e){a||(r[e].valid?Object.prototype.hasOwnProperty.call(r[e],"value")&&(t[r[e].name]=r[e].value):a=!0)})),console.log(t),a||e.submit(t)},l=c.a.Children.map(e.children,(function(e){if(e)return c.a.cloneElement(e,{inputChange:u})})).filter((function(e){return e}));return Object(n.useEffect)((function(){var t={};e.children.forEach((function(e){e&&(t[e.props.name]={name:e.props.name,valid:!e.props.required,required:!!e.props.required})})),s(t)}),[s]),c.a.createElement("form",{className:"form",onSubmit:function(e){e.preventDefault(),o()}},l,c.a.createElement(k,{onClick:function(){o()}},e.buttonLabel))},C=function(e){var t=Object(n.useState)(""),a=Object(d.a)(t,2),r=a[0],s=a[1],u=Object(n.useState)(!0),o=Object(d.a)(u,2),l=o[0],i=o[1],m=Object(n.useState)(!0),p=Object(d.a)(m,2),f=p[0],b=p[1];return Object(n.useEffect)((function(){f||function(){if(e.validation&&!f)if(!e.required||r){var t=new RegExp("[^@]+@[^.]+..+"),a=r.match(t);i(!!a)}else i(!1)}(),e.inputChange({name:e.name,value:r,valid:l,required:e.required})}),[f,r,l]),c.a.createElement("div",{className:"input"},c.a.createElement("label",{className:"input__label",htmlFor:e.name},e.label),c.a.createElement("input",{className:"input__input",type:"email",value:r,name:e.name,required:e.required,onChange:function(e){return s(e.target.value)},onBlur:function(e){f?b(!1):s(e.target.value)}}),!l&&c.a.createElement("span",{className:"error"},"Veuillez saisir une adresse email valide."))},_=function(e){var t=Object(n.useState)(""),a=Object(d.a)(t,2),r=a[0],s=a[1],u=Object(n.useState)(!0),o=Object(d.a)(u,2),l=o[0],i=o[1],m=Object(n.useState)(!0),p=Object(d.a)(m,2),f=p[0],b=p[1];return Object(n.useEffect)((function(){f||function(){if(e.validation&&!f)if(!e.required||r){var t=r.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,15}$/);i(!!t)}else i(!1)}(),e.inputChange({name:e.name,value:r,valid:l,required:e.required})}),[f,r,l]),c.a.createElement("div",{className:"input"},c.a.createElement("label",{className:"input__label",htmlFor:e.name},e.label),c.a.createElement("input",{className:"input__input",type:"password",value:r,name:e.name,required:e.required,onChange:function(e){return s(e.target.value)},onBlur:function(e){f?b(!1):s(e.target.value)}}),!l&&c.a.createElement("p",{className:"error"},"Le mot de passe doit contenir au moins 8 caract\xe8res (dont au moins une majuscule, une minuscule, un chiffre et un caract\xe8re sp\xe9cial)."))},L={home:{path:"/",label:"Accueil",component:O,menu:!1,guard:!1},spots:{path:"/spots",label:"Spots",component:function(){document.title="Saint Jacques | Spots";var e=Object(n.useState)([]),t=Object(d.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(!0),u=Object(d.a)(s,2),l=u[0],i=u[1],m=Object(n.useState)(!1),p=Object(d.a)(m,2),f=p[0],b=p[1];Object(n.useEffect)((function(){j.fetchSpots().then((function(e){var t=e.data;r(t["hydra:member"]),i(!1)})).catch((function(){b(!0),i(!1)}))}),[]);return c.a.createElement("section",null,c.a.createElement("h1",null,"Tous les spots"),l?c.a.createElement("span",null,"Chargement..."):f?c.a.createElement("span",null,"Une erreur est survenue."):a.length?c.a.createElement("ul",null,a.map((function(e,t){return c.a.createElement("li",{key:t},c.a.createElement(o.b,{to:"".concat("/saint-jacques","/spots/").concat(e.id)},e.name))}))):c.a.createElement("span",null,"Aucun spot trouv\xe9."))},menu:!0,guard:!1},spot:{path:"/spots/:id",label:"Spot",component:function(){document.title="Saint Jacques | Chargement...";var e=Object(n.useState)(!0),t=Object(d.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(!1),o=Object(d.a)(s,2),i=o[0],m=o[1],p=Object(n.useState)(!1),f=Object(d.a)(p,2),b=f[0],v=f[1],E=Object(n.useState)(!1),h=Object(d.a)(E,2),O=(h[0],h[1]),S=Object(n.useState)(!1),w=Object(d.a)(S,2),q=(w[0],w[1]),k=Object(n.useState)(null),N=Object(d.a)(k,2),C=N[0],_=N[1],y=Object(u.g)();Object(n.useEffect)((function(){j.fetchSpot(y.id).then((function(e){var t=e.data;document.title="Saint Jacques | ".concat(t.name),_(t),v(t.isFavorite),r(!1)})).catch((function(){m(!0),r(!1)}))}),[]);var x=function(){return!!l("jwt")?c.a.createElement("button",{onClick:function(){return q(!0),O(!0),void g[b?"removeFavoriteSpot":"addFavoriteSpot"](y.id).then((function(){O(!1),v(!b)})).catch((function(){q(!0),O(!1)}))}},b?"Retirer de mes favoris":"Ajouter \xe0 mes favoris"):c.a.createElement("div",null,c.a.createElement("span",null,"Connectez-vous pour ajouter ce spot \xe0 vos favoris"),c.a.createElement("button",{onClick:function(){window.location.replace("".concat("/saint-jacques").concat(L.signIn.path))}},"Se connecter"))};return c.a.createElement("section",{className:"page"},a?c.a.createElement("span",null,"Chargement..."):i?c.a.createElement("span",null,"Une erreur est survenue."):c.a.createElement("section",null,c.a.createElement("h1",null,C.name),c.a.createElement("span",null,"Longitude : ",C.longitude),c.a.createElement("span",null,"Latitude : ",C.longitude),c.a.createElement("p",null,C.description),x()))},menu:!1,guard:!1},signIn:{path:"/sign-in",label:"Se connecter",component:function(){document.title="Saint Jacques | Se connecter";var e=Object(n.useState)(!1),t=Object(d.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(!1),u=Object(d.a)(s,2),l=u[0],m=u[1];return c.a.createElement("section",{className:"page page--sign-in"},c.a.createElement("h1",null,"Se connecter"),l&&c.a.createElement("span",{class:"error"},"Les identifiants saisis ne sont pas valides."),c.a.createElement(N,{submit:function(e){return function(e){r(!0);var t=e.email,a=e.password;S({email:t,password:a}).then((function(e){200===e.status?(i("jwt",e.data.token),window.location.replace("".concat("/saint-jacques"))):(m(!0),r(!1))})).catch((function(){m(!0),r(!1)}))}(e)},buttonLabel:"Se connecter"},c.a.createElement(C,{required:!0,validation:!0,name:"email",label:"Email"}),c.a.createElement(_,{required:!0,validation:!1,name:"password",label:"Mot de passe"})),a&&c.a.createElement("span",null,"Chargement..."),c.a.createElement("span",{className:"mt--s mb--xs d-block"},"Vous n'avez pas encore de compte ?"," ",c.a.createElement(o.c,{exact:!0,to:"".concat("/saint-jacques").concat(L.signUp.path)},"Cr\xe9ez en un d\xe8s maintenant !")))},menu:!1,guard:!1},signUp:{path:"/sign-up",label:"S'inscrire'",component:function(){document.title="Saint Jacques | S'inscrire";var e=Object(n.useState)(!1),t=Object(d.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(!1),u=Object(d.a)(s,2),o=u[0],l=u[1],m=Object(n.useState)(!0),p=Object(d.a)(m,2),f=p[0],b=p[1];return c.a.createElement("section",{class:"page page--sign-up"},c.a.createElement("h1",null,"S'inscrire"),o&&c.a.createElement("span",{className:"error d-block mb--m"},"Les identifiants saisis ne sont pas valides. Il se peut que l'adresse email saisie soit d\xe9j\xe0 associ\xe9e \xe0 un compte."),c.a.createElement(N,{submit:function(e){return function(e){var t=e.email,a=e.password,n=e.passwordConfirmation;a===n?(b(!0),r(!0),w({email:t,password:a}).then((function(){S({email:t,password:a}).then((function(e){i("jwt",e.data.token),window.location.replace("".concat("/saint-jacques"))})).catch((function(){l(!0),r(!1)}))})).catch((function(){l(!0),r(!1)}))):b(!1)}(e)},buttonLabel:"S'inscrire"},c.a.createElement(C,{required:!0,validation:!0,name:"email",label:"Adresse email"}),c.a.createElement(_,{required:!0,validation:!0,name:"password",label:"Mot de passe"}),c.a.createElement(_,{required:!0,name:"passwordConfirmation",label:"Conformation du mot de passe"}),!f&&c.a.createElement("span",{className:"error d-block mb--s"},"Les mots de passe saisis ne sont pas identiques.")),a&&c.a.createElement("span",{className:"d-block mt--s"},"Chargement..."))},menu:!1,guard:!1},notfound:{path:"/404",label:"Erreur 404",component:function(){return document.title="Saint Jacques |\xa0404",c.a.createElement("section",null,c.a.createElement("h1",null,"Erreur 404"),c.a.createElement("p",null,"Cette pas n'existe pas..."," ",c.a.createElement("span",{role:"img","aria-label":"Sad face emoji"},"\ud83d\ude1e")))},menu:!1,guard:!1}},y=function(){var e=!!l("jwt"),t=Object.keys(L).map((function(t,a){var n=L[t],r=n.path,s=n.component,o=n.guard;return c.a.createElement(u.b,{key:a,exact:!0,path:"".concat("/saint-jacques").concat(r),render:function(){return function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0,n=a;return t?e?c.a.createElement(n,null):c.a.createElement(u.a,{to:"".concat("/saint-jacques").concat(L.signIn.path)}):c.a.createElement(n,null)}(o,s)}})}));return c.a.createElement(o.a,null,c.a.createElement(c.a.Fragment,null,c.a.createElement(p,{pages:L,isLogged:e}),c.a.createElement("main",{className:"container"},c.a.createElement(u.d,null,t))))};a(56);s.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(y,null)),document.getElementById("root"))}},[[29,1,2]]]);
//# sourceMappingURL=main.e6d157a2.chunk.js.map